# 网络模型

1. 网络有七层协议和四层协议之说。七层协议属于理论基础，目前的实际应用均为四层协议：
![image](https://user-images.githubusercontent.com/20439371/125456951-7357c55d-2dad-462d-8933-55f861d316f8.png)

- 其中四层协议裁剪掉了表示层和会话层
- 黄色部分的传输层，网络层，链路层均为内核态(意思就是由操作系统的内核来管理)。 应用层则由应用程序里处理。
- 当发生网络通信的时候，信息传输路径为：应用层(源)->传输层(源)->网络层(源)->链路层(源)->物理层(源)  ===>>> 物理层(目)-> 链路层(目)->网络层(目)->传输层(目)->应用层(目)。三次握手，四次分手同样也是这个过程(不包括应用层)

2. 应用层协议

> HTTP/https

> SMTP

* 用端口号来确定网络传输的数据包给哪个进程

3. 传输层协议

> TCP协议

TCP协议为可靠通信源于它的三次握手和四次分手。
* 三次握手：
![image](https://user-images.githubusercontent.com/20439371/125464923-2884ccb4-671c-4c01-a42b-f497fd4c8e5d.png)

  1. 第一次握手，源传输层向目的传输层发送通信请求。
  2. 第二次握手，目的传输层向源传输层发送同意通信的确认消息。
  3. 第三次握手，源传输层向目的传输层发送收到同意通信的确认消息，并附带通信数据一起发送。

* 四次分手：

![image](https://user-images.githubusercontent.com/20439371/125465020-9d649036-f81a-41ab-bef7-3a309e075f73.png)

  1. 第一次，源传输层向目的传输层发送断开通信请求。
  2. 第二次，目的传输层向源传输层发送收到断开信息请求的确认。
  3. 第三次，目的传输层向源传输层发送同意断开请求。
  4. 第四次，源传输层向目的传输层发送确认同意断开请求。

* 可以用`netstat -natp` 来查看TCP的状态：
![image](https://user-images.githubusercontent.com/20439371/125475780-d8299481-d822-4b56-a52e-6309cc22e9a7.png)


> UDP

4. 网络层协议

> IP协议

  * 在网络上表示一个地址，由4个2进制数组成，最大为255.255.255.255，最小为0.0.0.0
  * 分为公网IP地址和局域网IP地址。局域网内IP地址在局域网内不允许重复，不同的局域网可以相同。公网IP地址不允许相同
  * cat /etc/sysconfig/network-scripts/ifcfg-eth0( if: interface,  cfg: sysconfig, etho: 第一块网卡，如果有第二块网卡，就是eth1)

    文件中有4个主要信息：
        1. IPADDR: IP地址
        2. NETMASK: 子网掩码，与IP地址按位与得到网络号
        3. GATEWAY: 网关，下一条的地址。在家庭网建里，网关一般是路由器。
        4. DNS1/2: 域名地址
  * IP为端到端的协议，可以跨网络。
  * 用`route -n` 查看路由表。

     note:
           1. 如果网关是0.0.0.0，说明是局域网内的通信，可以直接到达
           2. 如果想从局域网，向外请求广域网，则先用DNS将广域网的域名转化为IP地址 -> 用此IP地址与上面的路由表中的网关做按位与操作(一般来讲，做完与操作之后的IP与Destination列都匹配不上，除非网关那一条，因为网关的子网掩码是0.0.0.0) -> 按位与的结果与Desitination列进行匹配，匹配上的行，就将数据包发送到相应的Gateway那一列的IP指向的地址。Gateway的地址仅仅是下一跳的地址，不一定是真正的目的地址。
           3. 如果发现上面的数据表为空的时候，出发RPT协议.
5. 链路层协议

> ARP协议

* 当电脑接入网络或TCP寻址无法找到网关的Mac地址时，触发RPT协议。(注意这个地方说的是不知道Mac地址，网关的IP地址还是知道的。)
      1. 首先主机会向交换机发送一个目标地址为FFFFFF, 目标IP为网关的消息
      2. 交换机接到目标地址为FFFFFF的数据包，会做一个全网的发送，同一局域网内的所有机器，都会收到来自交换机发送的这一数据包。
      3. 其他机器收到这个数据包后，发现目的IP地址与自己不相符，则丢弃数据包。网关收到这个数据包之后，因为目标IP与自己相同而且是ARP协议，则返回自己的Mac地址。
* 链路层是点到点的传输，通过Mac地址（网卡地址）实现下一跳。
* 可用`arp -a`来查看IP地址和Mac地址的映射表，仅限于同一局域网。
